\documentclass[
  ngerman,
  DIV=14
]{scrartcl}
\usepackage{babel}
\usepackage{csquotes}

% typography
\usepackage{mathpazo}
\usepackage{fontspec}
\setsansfont{Open Sans}[
  BoldFont={Open Sans Bold},
  ItalicFont={Open Sans Italic}]
\setmonofont{Menlo}
\renewcommand\familydefault{\sfdefault}
\usepackage[factor=2000]{microtype}

% graphics, drawings, etc.
\usepackage{xcolor}
\usepackage{graphicx}
\usepackage[most]{tcolorbox}
\usepackage{tikz}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{shapes.arrows}
\usetikzlibrary{positioning}
\newtcolorbox{anmerkung}{%
  grow to left by=10pt,
  colback=black!10,
  colframe=white,
  coltitle=black,
  borderline west={4pt}{0pt}{black!30},
  boxrule=0pt,
  boxsep=0pt,
  %breakable,
  enhanced jigsaw,
  title={Anmerkung\par},
  fonttitle={\bfseries},
  attach title to upper={}}
\newtcolorbox{hinweis}{%
  grow to left by=10pt,
  colback=black!10,
  colframe=white,
  coltitle=black,
  borderline west={4pt}{0pt}{black!30},
  boxrule=0pt,
  boxsep=0pt,
  %breakable,
  enhanced jigsaw,
  title={Hinweis\par},
  fonttitle={\bfseries},
  attach title to upper={}}

% highlighting, lists, code
\usepackage{soul}
\usepackage{enumitem}
\usepackage{listings}
\lstset{
  basicstyle=\ttfamily,
  %escapeinside=||,
  keywordstyle=\color{blue!50!black},
  stringstyle=\color{green!50!black}}
\capsdef{////}{\scshape}{.16em}{.4em}{.2em}

% math
\usepackage{amsmath,amssymb}

% nice tables
\usepackage{booktabs}
\newcommand{\tablespacing}[1]{\renewcommand{\arraystretch}{#1}}

% links
\usepackage[
  colorlinks,
  linkcolor={red!50!black},
  citecolor={blue!50!black},
  urlcolor={blue!80!black}
]{hyperref}

\title{Lösungsblatt Nr. 1}
\date{Wintersemester 2018-2019}
\author{Andreas Koch}
\subject{Einführung in den Compilerbau}
\subtitle{von Patrick Elsen, Viola und Michael Matthé}
\publishers{Technische Universität Darmstadt}

\begin{document}
\maketitle

\subsection*{Einleitung}

Auf diesem Aufgabenblatt sollen Sie sich mit der Matrix and Vector Language, kurz MAVL, vertraut machen. Studieren Sie bitte zunächst die MAVL-Sprachspezifikation, die Sie im Moodle-Kurs der Veranstaltung finden.

\subsection*{Aufgabe 1.1: MAVL-Syntax}

Die MAVL-Sprachspezifikation enthält nur eine informelle Beschreibung der Syntaxelemente der Sprache. In den folgenden Teilaufgaben sollen Sie einige der Syntaxelemente in Produktionen einer kontextfreien Grammatik überführen.

\medskip\noindent
Abweichend von den Vorlesungsfolien soll die Grammatik jedoch in erweiterter Backus-Naur-Form (EBNF) beschrieben werden: Sie können und sollen in den Produktionen den \verb|?|-Operator (0 oder 1 Wiederholung) und den \verb|*|-Operator (0 oder mehr Wiederholungen) verwenden. Beispielsweise können Sie eine Sequenz eines Nichtterminals A statt durch
\begin{verbatim}
    A ::= A single-A
        | single-A
\end{verbatim}
auch einfacher durch
\begin{verbatim}
    A ::= single-A (single-A)*
\end{verbatim}
ausdrücken.

\medskip\noindent
Verwenden Sie bitte folgende Terminalsymbole (Tokens):

\begin{table}[!htbp]\centering\tablespacing{1.3}
\begin{tabular}{@{}p{8cm}p{8cm}@{}}
\toprule
\textbf{Terminalsymbole} & \textbf{Bedeutung}\\
\midrule
\verb|ID| & Berzeichner, z. B. \verb|someVar_42|.\\
\verb|INT|, \verb|FLOAT|, \verb|BOOL|, \verb|STRING| & Vorzeichenlose Literale des entsprechenden Typs, z. B. \verb|17|, \verb|3.14|, \verb|false|, \verb|"foo"|.\\
\verb|'function'|, \verb|'val'|, \verb|'var'|, \verb|'for'|, \verb|'if'|, \verb|'else'|, \verb|'return'|, \verb|'foreach'|, \verb|'switch'|, \verb|'case'|, \verb|'default'|, \verb|'record'| & Schlüsselwörter.\\
\verb|'int'|, \verb|'float'|, \verb|'bool'|, \verb|'void'|, \verb|'string'|, \verb|'matrix'|, \verb|'vector'| & Schlüsselwörter für eingebaute Typen.\\
\verb|'('|, \verb|')'|, \verb|'{'|, \verb|'}'|, \verb|'['|, \verb|']'|, \verb|'<'|, \verb|'>'| & Klammern.\\
\bottomrule
\end{tabular}
\end{table}
\noindent
Whitespace-Symbole und Kommentare brauchen Sie nicht zu beachten. Lassen Sie in Ihrer Lösung nicht die einfachen Anführungsstriche weg -- sie dienen zur Unterscheidung der Tokens von den Operatoren der EBNF.

\begin{hinweis}
Beachten Sie, dass Sie die in der Spezifikation angegebenen kontextuellen Einschränkungen, z.B. Typkompatibilität, hier nicht prüfen müssen. Verwenden Sie eine möglichst kompakte Beschreibung der Syntaxelemente. Die Grammatik darf durch Ihre Produktionen mehrdeutig werden. Ignorieren Sie für diese Aufgabe außerdem § 7.9 der MAVL-Spezifikation: Ihre Produktionen müssen nicht die Mehrfachanwendung von unären Operatoren ausschließen.
\end{hinweis}

\begin{enumerate}
\item[a)]
Das Nichtterminal \verb|expr| dient zur Erkennung eines beliebig komplexen Ausdrucks wie z.~B.\ \verb|a * b + (c - m[3][1])|. In einer kontextfreien Grammatik lassen sich Ausdrücke als rekursive Produktionen beschreiben: Ein Ausdruck ist entweder ein atomarer Ausdruck oder entsteht durch die Anwendung eines Operators auf weitere (atomare oder zusammengesetzte) Ausdrücke.

\verb|expr| wird durch folgende Produktion beschrieben:
\begin{verbatim}
    expr ::= ID | INT | FLOAT | STRING
           | '(' expr ')'
           | ...
           | mulExpr
           | subvectorExpr
           | recordElementSelectExpr
           | ...
\end{verbatim}

Geben Sie Produktionen für die Nichtterminale \texttt{mulExpr} (Multiplikations-Operator), \texttt{subvectorExpr} (Subvektor-Operator), sowie \texttt{recordElementSelectExpr} (Selektion von Record-Elementen) an.
\end{enumerate}
Ein Multiplikationsausdruck ist in der Sprachspezifikation unter \emph{§~7.5 Ternärer Operator} definiert. Ein solcher Ausdruck nimmt \verb|int| oder \verb|float|-Werte als Parameter und ist Linksassoziativ. Also kann man diesen grammatikalisch folgendermaßen definieren.
\begin{verbatim}
    mulExpr ::= (INT | FLOAT) '*' expr
\end{verbatim}
Die \verb|subvectorExpr| ist in dem Sprachstandard unter \emph{§~7.7.4 Submatrix und Subvektor} definiert. Hier wird definiert, dass eine solche Beispielsweise als \verb|v{-1:i:1}| geschrieben werden kann, wobei \verb|v| ein Vektor und \verb|i| eine Zahl sein muss. Dieser Ausdruck extrahiert einen Subvektor mit den Elementen $[i-1, i+1]$. 
\begin{verbatim}
    subvectorExpr ::= '{' expr ':' expr ':' expr '}'  
\end{verbatim}
Unter \emph{§~7.8 Selektion von Record-Elementen} ist definiert, wie der Syntax funktioniert.
\begin{verbatim}
    recordElementSelectExpr ::= ID '@' ID  
\end{verbatim}
\begin{enumerate}
\item[b)]
Das Nichtterminal \texttt{type} dient zur Erkennung von Typbezeichnern wie z.~B. \texttt{vector<float>[5]}. \texttt{type} wird durch folgende Produktion beschrieben:
\begin{verbatim}
    type ::= primitiveType
           | vectorType
           | ...
\end{verbatim}
Geben Sie Produktionen für die Nichtterminale \verb|primitiveType| (primitive Typen) und \verb|vectorType| (Vektortypen) an.
\end{enumerate}
Die primitiven Typen sind unter \emph{§~4.2 Primitive Datentypen} definiert. Hier sind nur \texttt{int}, \texttt{float} und \texttt{bool} als eingebaute, primitive Typen angegeben. Also könnte eine Grammatik folgendermaßen aussehen:
\begin{verbatim}
    primitiveType ::= 'int' | 'float' | 'bool'
\end{verbatim}
Der \texttt{vectorType} ist bei \emph{§~4.5 Vektoren} definiert. Ein Vektor muss, mit einem Elementtyp (entweder \texttt{int} oder \texttt{float}) und einer Länge (positive, ganze Zahl) definiert werden.
\begin{verbatim}
    vectorType ::= 'vector' '<' ('int' | 'float') '>' '[' constExpr ']'
\end{verbatim}
\begin{enumerate}
\item[c)]
Das Nichtterminal \texttt{statement} dient zur Erkennung von Befehlen und wird durch folgende Produktion beschrieben:
\begin{verbatim}
    statement ::= returnStmt
                | varDecl
                | callStmt
                | forStmt
                | ...
\end{verbatim}
Geben Sie Produktionen für die Nichtterminale \texttt{returnStmt} (Rückgabebefehl), \texttt{varDecl} Variablendeklaration), \texttt{callStmt} (Aufruf-Befehl, ohne Rückgabewert) sowie \texttt{forStmt} (For-Schleife) an.
\end{enumerate}



\subsection*{Aufgabe 1.2: AST zu MAVL}
Abstrakte Syntaxbäume (engl. \emph{Abstract Syntax Trees, AST}) sind eine weitverbreitete Zwischendarstellung, die nur essentielle Informationen enthält und Details der konkreten Syntax einer Programmiersprache abstrahiert.

\medskip\noindent
In dieser Aufgabe zeigen wie Ihnen eine mögliche Repräsentation von MAVL-Code als AST. Die darin verwendeten AST-Knoten korrespondieren auf natürliche Weise mit den in der Spezifikation beschriebenen Syntaxelementen. 
\begin{enumerate}
\item [a)]
Geben Sie den zum folgenden AST zugehörigen MAVL-Code an.  
\end{enumerate}
Den Syntaxbaum kann man, von oben nach unten und links nach rechts, einfach wie Code lesen.
\begin{lstlisting}
if(id && r > q) {
  r = -1;
  q(q, r);
} else {
  r = a - (q * d);
}
\end{lstlisting}


\end{document}